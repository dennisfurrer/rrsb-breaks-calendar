<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RRSB Statistics</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      .container {
        width: 60%;
        margin: 0 auto;
      }
      .date-selector,
      .table-container {
        text-align: center;
        margin-bottom: 20px;
      }
      table {
        width: 100%;
        margin-top: 10px;
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
      @media screen and (max-width: 768px) {
        .container {
          width: 100%;
          padding: 0 10px;
          box-sizing: border-box;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="date-selector">
        <button id="prev-date">&lt;</button>
        <input type="date" id="current-date" />
        <button id="next-date">&gt;</button>
      </div>
      <label>
        <input type="checkbox" id="toggle-leaderboard" />
        Show all-time breaks leaderboard
      </label>
      <div class="table-container">
        <h2>Daily Breaks</h2>
        <table id="breaks-table">
          <thead>
            <tr>
              <th>Player Name</th>
              <th>High Breaks</th>
            </tr>
          </thead>
          <tbody>
            <!-- Data rows will be added here dynamically -->
          </tbody>
        </table>
      </div>
      <hr />
      <div
        class="table-container"
        id="leaderboard-container"
        style="display: none"
      >
        <h2>Breaks Leaderboard All-Time</h2>
        <table id="leaderboard-table">
          <thead>
            <tr>
              <th>Player Name</th>
              <th>High Breaks</th>
            </tr>
          </thead>
          <tbody>
            <!-- Leaderboard data rows will be added here dynamically -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const currentDateInput = document.getElementById("current-date");
        const prevDateButton = document.getElementById("prev-date");
        const nextDateButton = document.getElementById("next-date");
        const leaderboardContainer = document.getElementById(
          "leaderboard-container"
        );
        const toggleLeaderboardCheckbox =
          document.getElementById("toggle-leaderboard");

        currentDateInput.valueAsDate = new Date();
        fetchAndDisplayBreaks(currentDateInput.value);

        currentDateInput.addEventListener("change", function () {
          fetchAndDisplayBreaks(currentDateInput.value);
        });

        prevDateButton.addEventListener("click", function () {
          changeDate(-1);
        });

        nextDateButton.addEventListener("click", function () {
          changeDate(1);
        });

        toggleLeaderboardCheckbox.addEventListener("change", function () {
          leaderboardContainer.style.display = this.checked ? "block" : "none";
          if (this.checked) {
            fetchAndDisplayLeaderboard();
          }
        });

        function changeDate(days) {
          let currentDate = new Date(currentDateInput.value);
          currentDate.setDate(currentDate.getDate() + days);
          currentDateInput.valueAsDate = currentDate;
          fetchAndDisplayBreaks(currentDateInput.value);
        }

        function fetchAndDisplayBreaks(date) {
          fetch(`https://rrsb-scoreboard-server.onrender.com/breaks/${date}`)
            .then((response) => response.json())
            .then((data) => updateTable("breaks-table", data.data))
            .catch((error) => console.error("Error fetching data:", error));
        }

        function fetchAndDisplayLeaderboard() {
          fetch(
            "https://rrsb-scoreboard-server.onrender.com/breaks/leaderboard"
          )
            .then((response) => response.json())
            .then((data) => updateTable("leaderboard-table", data.data))
            .catch((error) =>
              console.error("Error fetching leaderboard data:", error)
            );
        }

        function updateTable(tableId, data) {
          const tableBody = document
            .getElementById(tableId)
            .querySelector("tbody");
          tableBody.innerHTML = ""; // Clear existing rows

          data.forEach((player) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                        <td>${player.name}</td>
                        <td>${player.highbreaks.join(", ")}</td>
                    `;
            tableBody.appendChild(row);
          });
        }
      });
    </script>
  </body>
</html>
